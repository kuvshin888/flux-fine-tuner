# Configuration for Cog ⚙️
# Reference: https://cog.run/yaml

# Автоматическое имя для деплоя на Replicate
image: "r8.im/kuvshin888/flux-fine-tuner-init-lora"

build:
  gpu: true
  cuda: "12.1"
  python_version: "3.10"
  python_requirements: "requirements.txt"
  run:
    # Установка LLaVA из GitHub
    - pip install --no-cache-dir "git+https://github.com/haotian-liu/LLaVA.git"
    
    # Установка ai-toolkit из GitHub
    - pip install --no-cache-dir "git+https://github.com/ostris/ai-toolkit.git"
    
    # Установка pget для загрузки файлов
    - curl -o /usr/local/bin/pget -L "https://github.com/replicate/pget/releases/download/v0.8.2/pget_linux_x86_64" && chmod +x /usr/local/bin/pget
    
    # Установка специальной версии diffusers для FLUX
    - pip install --no-cache-dir "git+https://github.com/Gothos/diffusers.git@flux-inpaint"
    
    # Очистка кэша для экономии места
    - pip cache purge
    - rm -rf /root/.cache/pip
    - apt-get clean
    - rm -rf /var/lib/apt/lists/*

# predict.py defines how predictions are run on your model
predict: "predict.py:Predictor"
train: "train.py:train"
